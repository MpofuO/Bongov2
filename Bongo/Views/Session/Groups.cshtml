@model GroupsViewModel
@{
    ViewData["Title"] = "Choose Groups";
}

<div class="session-prep bg-light shadow w-sm-50">
    @if (Model.GroupedLectures.Count > 0)
    {
        <h4 class="mb-4">Please select the class you will attend for each of the following</h4>
        <div>
            <input name="GroupedLectures" value="@Model.GroupedLectures" hidden />
            <form asp-action="Groups" method="post">
                @foreach (Lecture lect in Model.GroupedLectures)
                {
                    List<SelectListItem> groupList = new List<SelectListItem>();
                    Session selected = lect.sessions.FirstOrDefault(s => s.sessionInPDFValue.Contains("selectedGroup"));
                    string value, displayText;
                    if (selected != null)
                    {
                        value = selected.sessionInPDFValue.Replace("selectedGroup", "");
                        displayText = value;
                        groupList.Add(new SelectListItem { Value = value, Text = displayText, Selected = true });
                        lect.sessions.Remove(selected);
                    }
                    groupList.AddRange((lect.sessions.
                    Select(s => new SelectListItem
                    {
                        Value = s.sessionInPDFValue,
                        Text = s.sessionInPDFValue.Replace("disabled", ""),
                        Disabled = Model.CheckDisabled(s.sessionInPDFValue)
                    })));


                    <div class="form-group">
                        <label class="mb-2 fw-bold">@lect.ModuleCode</label>, <label>@lect.LectureDesc.ToLower()</label>
                        @Html.DropDownList("Sessions", groupList, "--- select a class ---", new { @class = "form-select mb-2", @required = "required" })
                        @if (Extensions.HasGroups(lect.sessions))
                        {
                           <div class="form-check mb-4">
                               <input class="form-check-input" type="checkbox" name="SameGroups" 
                               value="@lect.ModuleCode @lect.LectureDesc" />
                               <label class="form-check-label">
                                   Select all sessions of the same group
                               </label>
                           </div>
                        }
                    </div>
                }
                <div class="d-flex session-prep-buttons">
                    <button class="btn btn-primary" type="submit" title="Continue"><i class=" fa-solid fa-arrow-right"></i></button>
                </div>
            </form>
        </div>

    }
    else
    {
        <h4>You currently do not have Grouped Lectures😊</h4>
        <div class="d-flex session-prep-buttons">
            <a class="btn btn-primary" asp-controller="Home" asp-action="Index" asp-route-isForFirstSemester="@TempData["isForFirstSemester"]" title="Go back"><i class=" fa-solid fa-arrow-right"></i></a>
        </div>
    }
</div>
